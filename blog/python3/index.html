<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SugerZheng的博客 | Python Socket</title>
    <meta name="description" content="怪獸別跑biubiu">
    
    
    <link rel="preload" href="/assets/css/8.styles.38aff4fb.css" as="style"><link rel="preload" href="/assets/js/app.92be1f84.js" as="script"><link rel="preload" href="/assets/js/1.214ac14b.js" as="script"><link rel="prefetch" href="/assets/js/4.5c6da903.js"><link rel="prefetch" href="/assets/js/0.aa826e8c.js"><link rel="prefetch" href="/assets/js/2.76edc6ef.js"><link rel="prefetch" href="/assets/js/3.21d95acc.js"><link rel="prefetch" href="/assets/js/5.61918392.js"><link rel="prefetch" href="/assets/js/6.3ee9cb1c.js"><link rel="prefetch" href="/assets/js/7.b79159d7.js">
    <link rel="stylesheet" href="/assets/css/8.styles.38aff4fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      SugerZheng的博客
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/python3/" class="nav-link router-link-exact-active router-link-active">biubiu</a></div><a href="https://github.com/SugerZheng" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/python3/" class="nav-link router-link-exact-active router-link-active">biubiu</a></div><a href="https://github.com/SugerZheng" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Python3</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/blog/python3/" class="active sidebar-link">Python Socket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/python3/#python-基于socket实现简单聊天程序示例" class="sidebar-link">Python 基于Socket实现简单聊天程序示例</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScript</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Git</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>FontEndInterview</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="python-socket"><a href="#python-socket" aria-hidden="true" class="header-anchor">#</a> Python Socket</h1><h2 id="python-基于socket实现简单聊天程序示例"><a href="#python-基于socket实现简单聊天程序示例" aria-hidden="true" class="header-anchor">#</a> Python 基于Socket实现简单聊天程序示例</h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>一、面向连接的套接字Socket通信工作流程</p></div><p>为了实现服务器与客户机的通信,服务器和客户机都必须建立套接字。服务器与客户机的工作原理可以用下面的过程来描述。
1.服务器先用 socket 函数来建立一个套接字,用这个套接字完成通信的监听。
2.用 bind 函数来绑定一个端口号和 IP 地址。因为本地计算机可能有多个网址和 IP,每一个 IP 和端口有多个端口。需要指定一个 IP 和端口进行监听。
3.服务器调用 listen 函数,使服务器的这个端口和 IP 处于监听状态,等待客户机的连接。
4.客户机用 socket 函数建立一个套接字,设定远程 IP 和端口。
5.客户机调用 connect 函数连接远程计算机指定的端口。
6.服务器用 accept 函数来接受远程计算机的连接,建立起与客户机之间的通信。
7.建立连接以后,客户机用 write 函数向 socket 中写入数据。也可以用 read 函数读取服务器发送来的数据。
8.服务器用 read 函数读取客户机发送来的数据,也可以用 write 函数来发送数据。
9.完成通信以后,用 close 函数关闭 socket 连接。</p><p><img src="/assets/img/socket.bcdbb3a3.png" alt="面向链接的套接字通信工作流程"></p><div class="warning custom-block"><p class="custom-block-title">该图片来自网络</p></div><div class="tip custom-block"><p class="custom-block-title">Server.py</p></div><pre class="language-python"><code><span class="token comment"># 文件名：server.py</span>

<span class="token comment"># 导入 socket 模块</span>
<span class="token keyword">import</span> socket

<span class="token comment"># 创建 socket 对象</span>
s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> 

<span class="token comment"># 获取本地主机名</span>
host <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostname<span class="token punctuation">(</span><span class="token punctuation">)</span>
port <span class="token operator">=</span> <span class="token number">9999</span>

<span class="token comment"># 绑定端口号</span>
s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 设置最大连接数，超过后排队</span>
s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 建立客户端连接</span>
sock<span class="token punctuation">,</span>addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>      
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Connection built!'</span><span class="token punctuation">)</span>
info<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">while</span> info<span class="token operator">!=</span><span class="token string">'exit'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Husband:'</span><span class="token operator">+</span>info<span class="token punctuation">)</span>
    send_mes<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>send_mes<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> send_mes<span class="token operator">==</span><span class="token string">'exit'</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    info<span class="token operator">=</span>sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="tip custom-block"><p class="custom-block-title">Client.py</p></div><pre class="language-python"><code><span class="token comment"># 文件名：client.py</span>

<span class="token comment"># 导入 socket模块</span>
<span class="token keyword">import</span> socket

<span class="token comment"># 创建 socket 对象</span>
s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment"># 获取本地主机名</span>
host <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostname<span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment"># 设置端口号</span>
port <span class="token operator">=</span> <span class="token number">9999</span>

<span class="token comment"># 连接服务，指定主机和端口</span>
s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Likend!'</span><span class="token punctuation">)</span>
info<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">while</span> info<span class="token operator">!=</span><span class="token string">'exit'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Wife:'</span><span class="token operator">+</span>info<span class="token punctuation">)</span>
    send_mes<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>send_mes<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> send_mes<span class="token operator">==</span><span class="token string">'exit'</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
   <span class="token comment"># 接收小于 1024 字节的数据</span>
    info <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="tip custom-block"><p class="custom-block-title">在终端先启动服务器，再启动客户端，便可以互相通信，目前只是实现了当服务器端输入'exit'，便断开连接。</p></div></div><!----><div class="content page-nav"><p class="inner"><!----><span class="next"><a href="/blog/javascript/">
          JavaScript
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/1.214ac14b.js" defer></script><script src="/assets/js/app.92be1f84.js" defer></script>
  </body>
</html>
